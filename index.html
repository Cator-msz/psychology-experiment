<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心理学实验 - 入口</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center px-4">
    <div class="bg-white rounded-lg shadow-md p-8 max-w-md w-full text-center">
        <h1 class="text-2xl font-bold text-primary mb-6">心理学实验</h1>
        <p class="text-gray-700 mb-8">请稍等，系统正在为你分配实验版本...</p>
        <i class="fa fa-spinner loading text-primary text-3xl mb-6"></i>
        <p class="text-sm text-gray-500">实验全程约15-20分钟，你的回答将完全匿名</p>
    </div>

    <script>
        // 定义四种实验版本（对应你的四个HTML文件）
        const experimentVersions = [
            { id: 1, name: "低攻击性+观点一致", url: "index1.html" },
            { id: 2, name: "低攻击性+观点不一致", url: "index2.html" },
            { id: 3, name: "高攻击性+观点一致", url: "index3.html" },
            { id: 4, name: "高攻击性+观点不一致", url: "index4.html" }
        ];

        // 核心：随机分配函数（保证平均分配）
        function assignExperimentVersion() {
            // 1. 检查是否已分配过版本（防止重复分配）
            const assignedVersion = localStorage.getItem('experimentVersion');
            if (assignedVersion) {
                return JSON.parse(assignedVersion);
            }

            // 2. 获取当前各版本的分配计数（localStorage存储计数，保证均分）
            let versionCounts = JSON.parse(localStorage.getItem('versionCounts')) || {
                1: 0, 2: 0, 3: 0, 4: 0
            };

            // 3. 找到当前计数最少的版本（优先分配给人数少的版本，保证平均）
            let minCount = Math.min(...Object.values(versionCounts));
            let candidateVersions = experimentVersions.filter(v => versionCounts[v.id] === minCount);

            // 4. 从候选版本中随机选一个
            let randomIndex = Math.floor(Math.random() * candidateVersions.length);
            let selectedVersion = candidateVersions[randomIndex];

            // 5. 更新计数并保存
            versionCounts[selectedVersion.id]++;
            localStorage.setItem('versionCounts', JSON.stringify(versionCounts));
            
            // 6. 保存当前参与者的分配结果
            localStorage.setItem('experimentVersion', JSON.stringify(selectedVersion));

            return selectedVersion;
        }

        // 执行分配并跳转
        window.onload = function() {
            // 延迟1.5秒跳转（模拟加载，提升体验）
            setTimeout(() => {
                const selectedVersion = assignExperimentVersion();
                window.location.href = selectedVersion.url;
            }, 1500);
        };
    </script>
</body>
</html>